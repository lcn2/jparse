.\" section 1 man page for run_flex.sh
.\"
.\" This man page was first written by Cody Boone Ferguson for the IOCCC
.\" in 2022.
.\"
.\" Humour impairment is not virtue nor is it a vice, it's just plain
.\" wrong: almost as wrong as JSON spec mis-features and C++ obfuscation! :-)
.\"
.\" "Share and Enjoy!"
.\"     --  Sirius Cybernetics Corporation Complaints Division, JSON spec department. :-)
.\"
.TH run_flex.sh 8 "30 January 2023" "run_flex.sh" "jparse tools"
.SH NAME
.B run_flex.sh
\- run
.BR flex (1)
to generate C code from a
.I *.l
file or use backup files if error
.SH SYNOPSIS
.B run_flex.sh
.RB [\| \-h \| ]
.RB [\| \-V \|]
.RB [\| \-v
.IR level \|]
.RB [\| \-o \|]
.RB [\| \-f
.IR flex \|]
.RB [\| \-g
.IR verge \|]
.RB [\| \-p
.IR prefix \|]
.RB [\| \-s
.IR sorry.h \|]
.RB [\| \-S]
.RB [\| \-F
.IR dir \|]
.RB [\| \-D
.IR dir \|]
.B \-\-
.RB [\|
.RI flex_flags \|]
.SH DESCRIPTION
.B run_flex.sh
attempts to find a recent enough version of
.BR flex (1)
(minimum version defined in
.I run_flex.sh\c
\&) and use it to generate code from the
.I prefix.l
file.
The default prefix is
.I jparse
but this script can be used for other scanners as well.
If a recent enough version is not found or
.BR flex (1)
encounters an error (syntax error or anything else) and the
.B \-o
option is not specified, it attempts to use the backup files
.I prefix.ref.c
and
.IR prefix.lex.ref.h .
.SH OPTIONS
.TP
.B \-h
Print help and exit.
.TP
.B \-V
Print version and exit.
.TP
.BI \-v\  level
Set verbosity level to
.IR level
(def: 0).
.TP
.B \-o
Do
.B NOT
use backup files.
If
.BR flex (1)
cannot be used or fails to generate the files the script will fail.
.TP
.BI \-f\  flex
Set
.BR flex (1)
basename to
.IR flex .
.TP
.BI \-g\  verge
Set path to the
.BR verge (1)
tool to
.IR verge .
This is used to determine if the
.BR flex (1)
tool is recent enough.
.TP
.BI \-p\  prefix
Set prefix of files to use to
.IR prefix .
The
.BR flex (1)
input file will be
.IR prefix.l .
If the
.B \-o
option was not used and
.BR flex (1)
cannot be used or fails then the backup files
.I prefix.ref.c
and
.I prefix.lex.ref.h
will be used.
.TP
.BI \-s\  sorry.h
Set path of file to prepend to the C output to
.IR sorry.h .
.TP
.B \-S
Suppress prepending apology to generated C output files.
.TP
.BI \-F\  flex_dir
Add directory
.I flex_dir
to list to search for
.BR flex (1).
.B \-F
can be used more than once.
If not used the script looks at
.BR $PATH .
.TP
.BI \-D\  dir
Set directory to find the
.BR flex (1)
source file.
Default is
.I .
(dot).
.PP
The
.I flex_flags
are any optional flags to give to
.BR flex (1)
before the prefix.
.SH EXIT STATUS
.TP
0
.BR flex (1)
output files formed or backup files used instead
.TQ
1
.BR flex (1)
not found or too old and
.B \-o
used
.TQ
2
good
.BR flex (1)
found and ran but failed to form proper output files
.TQ
3
.BR flex (1)
input file missing or not readable: backup files had to be used
.TQ
4
backup files missing or are not readable
.TQ
5
failed to use backup files to form the
.BR flex (1)
C output files
.TQ
6
.I sorry.h
file missing/not readable or
.B verge
missing/not executable
.TQ
.TQ
7
\-h and help string printed or \-V and version string printed
.TQ
8
command line usage error
.TQ
>=10
internal error
.SH NOTES
.PP
The
.B \-o
option is mainly for maintainers of the
.B jparse
scanner and parser but it can be used to test if you have a recent enough version of
.BR flex (1).
The idea behind it is if
.BR flex (1)
fails it might indicate a syntax error which the authors of
.B jparse
would need to fix.
.PP
Beware that some
.BR make (1)
implementations have a default rule for
.I *.l
files, so that if one were to do something like:
.sp
.RS
.ft B
 touch foo.l
 make
.ft R
.RE
.sp
the file
.I foo.c
is supposed to exist (and not generated by
.BR flex (1))
would be overwritten and cause a compilation error, if
.B foo
is by default compiled by the Makefile.
.SH BUGS
.PP
If you have any issues with the tool you can open an issue at
.br
.IR \<https://github.com/xexyl/jparse/issues\> .
.SH EXAMPLES
.PP
Run
.B run_flex.sh
with default options, which should attempt to run
.BR flex (1)
on the
.I jparse.l
file:
.sp
.RS
.ft B
 ./run_flex.sh
.ft R
.RE
.PP
Run
.B run_flex.sh
but specify that the backup files are not to be used in case a recent enough version of
.BR flex (1)
cannot be found or fails for some reason (for instance because there is an error in the lexer source file):
.sp
.RS
.ft B
 ./run_flex.sh \-o
.ft R
.RE
.PP
Try and run
.BR flex (1)
on the file
.I foobar.l
and don't use the backup files:
.sp
.RS
.ft B
 ./run_flex.sh \-o \-p foobar
.ft R
.RE
.PP
Try and run
.BR flex (1)
on the file
.I foobar.l
with lex instead of
.BR flex (1)
and don't use the backup files:
.sp
.RS
.ft B
 ./run_flex.sh \-o \-p foobar \-f lex
.ft R
.RE
.SH SEE ALSO
.BR run_bison (1),
.BR jparse (1)
